import{_ as a,o as e,c as n,R as s}from"./chunks/framework.O0REyYVi.js";const f=JSON.parse('{"title":"Mission Command Tree","description":"","frontmatter":{},"headers":[],"relativePath":"en/qgc-dev-guide/plan/mission_command_tree.md","filePath":"en/qgc-dev-guide/plan/mission_command_tree.md"}'),o={name:"en/qgc-dev-guide/plan/mission_command_tree.md"},i=s(`<h1 id="mission-command-tree" tabindex="-1">Mission Command Tree <a class="header-anchor" href="#mission-command-tree" aria-label="Permalink to &quot;Mission Command Tree&quot;">​</a></h1><p>QGC creates the user interface for editing a specific mission item command dynamically from a hierarchy of json metadata. This hierarchy is called the Mission Command Tree. This way only json metadata must be created when new commands are added.</p><h2 id="why-a-tree" tabindex="-1">Why a tree? <a class="header-anchor" href="#why-a-tree" aria-label="Permalink to &quot;Why a tree?&quot;">​</a></h2><p>The tree is needed to deal with the idosyncracies of differening firmware supporting commands differently and/or different vehicle types supporting the commands in different ways. The simplest example of that is mavlink spec may include command parameters which are not supported by all firmwares. Or command parameters which are only valid for certain vehicle types. Also in some cases a GCS may decide to hide some of the command parameters from view to end users since they are too complex or cause usability problems.</p><p>The tree is the MissionCommandTree class: <a href="https://github.com/mavlink/qgroundcontrol/blob/master/src/MissionManager/MissionCommandTree.cc" target="_blank" rel="noreferrer">MissionCommandTree.cc</a>, <a href="https://github.com/mavlink/qgroundcontrol/blob/master/src/MissionManager/MissionCommandTree.h" target="_blank" rel="noreferrer">MissionCommandTree.h</a></p><h3 id="tree-root" tabindex="-1">Tree Root <a class="header-anchor" href="#tree-root" aria-label="Permalink to &quot;Tree Root&quot;">​</a></h3><p>The root of the tree is json metadata which matches the mavlink spec exactly.</p><p>Here you can see an example of the root <a href="https://github.com/mavlink/qgroundcontrol/blob/master/src/MissionManager/MavCmdInfoCommon.json#L27" target="_blank" rel="noreferrer">json</a> for <code>MAV_CMD_NAV_WAYPOINT</code>:</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span>        {</span></span>
<span class="line"><span>            &quot;id&quot;:                   16,</span></span>
<span class="line"><span>            &quot;rawName&quot;:              &quot;MAV_CMD_NAV_WAYPOINT&quot;,</span></span>
<span class="line"><span>            &quot;friendlyName&quot;:         &quot;Waypoint&quot;,</span></span>
<span class="line"><span>            &quot;description&quot;:          &quot;Travel to a position in 3D space.&quot;,</span></span>
<span class="line"><span>            &quot;specifiesCoordinate&quot;:  true,</span></span>
<span class="line"><span>            &quot;friendlyEdit&quot;:         true,</span></span>
<span class="line"><span>            &quot;category&quot;:             &quot;Basic&quot;,</span></span>
<span class="line"><span>            &quot;param1&quot;: {</span></span>
<span class="line"><span>                &quot;label&quot;:            &quot;Hold&quot;,</span></span>
<span class="line"><span>                &quot;units&quot;:            &quot;secs&quot;,</span></span>
<span class="line"><span>                &quot;default&quot;:          0,</span></span>
<span class="line"><span>                &quot;decimalPlaces&quot;:    0</span></span>
<span class="line"><span>            },</span></span>
<span class="line"><span>            &quot;param2&quot;: {</span></span>
<span class="line"><span>                &quot;label&quot;:            &quot;Acceptance&quot;,</span></span>
<span class="line"><span>                &quot;units&quot;:            &quot;m&quot;,</span></span>
<span class="line"><span>                &quot;default&quot;:          3,</span></span>
<span class="line"><span>                &quot;decimalPlaces&quot;:    2</span></span>
<span class="line"><span>            },</span></span>
<span class="line"><span>            &quot;param3&quot;: {</span></span>
<span class="line"><span>                &quot;label&quot;:            &quot;PassThru&quot;,</span></span>
<span class="line"><span>                &quot;units&quot;:            &quot;m&quot;,</span></span>
<span class="line"><span>                &quot;default&quot;:          0,</span></span>
<span class="line"><span>                &quot;decimalPlaces&quot;:    2</span></span>
<span class="line"><span>            },</span></span>
<span class="line"><span>            &quot;param4&quot;: {</span></span>
<span class="line"><span>                &quot;label&quot;:            &quot;Yaw&quot;,</span></span>
<span class="line"><span>                &quot;units&quot;:            &quot;deg&quot;,</span></span>
<span class="line"><span>                &quot;nanUnchanged&quot;:     true,</span></span>
<span class="line"><span>                &quot;default&quot;:          null,</span></span>
<span class="line"><span>                &quot;decimalPlaces&quot;:    2</span></span>
<span class="line"><span>            }</span></span>
<span class="line"><span>        },</span></span></code></pre></div><p>Note: In reality this based information should be provided by mavlink itself and not needed to be part of a GCS.</p><h3 id="leaf-nodes" tabindex="-1">Leaf Nodes <a class="header-anchor" href="#leaf-nodes" aria-label="Permalink to &quot;Leaf Nodes&quot;">​</a></h3><p>The leaf nodes then provides metadata which can override values for the command and/or remove parameters from display to the user. The full tree hierarchy is this:</p><ul><li>Root - Generic Mavlink <ul><li>Vehicle Type Specific - Vehicle specific overrides to the generic spec</li><li>Firmware Type Specific - One optional leaf node for each firmware type (PX4/ArduPilot) <ul><li>Vehicle Type Specific - One optional leaf node for each vehicel type (FW/MR/VTOL/Rover/Sub)</li></ul></li></ul></li></ul><p>Note: In reality this override capability should be part of mavlink spec and should be able to be queried from the vehicle.</p><h3 id="building-the-instance-tree-from-the-full-tree" tabindex="-1">Building the instance tree from the full tree <a class="header-anchor" href="#building-the-instance-tree-from-the-full-tree" aria-label="Permalink to &quot;Building the instance tree from the full tree&quot;">​</a></h3><p>Since the json metadata provides information for all firmware/vehicle type combinations the actual tree to use must be built based on the firmware and vehicle type which is being used to create a Plan. This is done through a process call &quot;collapsing&quot; the full tree to a firmware/vehicle specific tree (<a href="https://github.com/mavlink/qgroundcontrol/blob/master/src/MissionManager/MissionCommandTree.cc#L119" target="_blank" rel="noreferrer">code</a>).</p><p>The steps are as follows:</p><ul><li>Add the root to the instance tree</li><li>Apply the vehicle type specific overrides to the instance tree</li><li>Apply the firmware type specific overrides to the instance tree</li><li>Apply the firmware/vehicle type specific overrides to the instance tree</li></ul><p>The resulting Mission Command Tree is then used to build UI for the Plan View item editors. In reality it is used for more than just that, there are many other places where knowing more information about a specific command id is useful.</p><h2 id="example-hierarchy-for-mav-cmd-nav-waypoint" tabindex="-1">Example hierarchy for <code>MAV_CMD_NAV_WAYPOINT</code> <a class="header-anchor" href="#example-hierarchy-for-mav-cmd-nav-waypoint" aria-label="Permalink to &quot;Example hierarchy for \`MAV_CMD_NAV_WAYPOINT\`&quot;">​</a></h2><p>Let&#39;s walk through an example hierarchy for <code>MAV_CMD_NAV_WAYPOINT</code>. Root information is shown above.</p><h3 id="root-vehicle-type-specific-leaf-node" tabindex="-1">Root - Vehicle Type Specific leaf node <a class="header-anchor" href="#root-vehicle-type-specific-leaf-node" aria-label="Permalink to &quot;Root - Vehicle Type Specific leaf node&quot;">​</a></h3><p>The next level of the hiearchy is generic mavlink but vehicle specific. Json files are here: <a href="https://github.com/mavlink/qgroundcontrol/blob/master/src/MissionManager/MavCmdInfoMultiRotor.json" target="_blank" rel="noreferrer">MR</a>, <a href="https://github.com/mavlink/qgroundcontrol/blob/master/src/MissionManager/MavCmdInfoFixedWing.json" target="_blank" rel="noreferrer">FW</a>, <a href="https://github.com/mavlink/qgroundcontrol/blob/master/src/MissionManager/MavCmdInfoRover.json" target="_blank" rel="noreferrer">ROVER</a>, <a href="https://github.com/mavlink/qgroundcontrol/blob/master/src/MissionManager/MavCmdInfoSub.json" target="_blank" rel="noreferrer">Sub</a>, <a href="https://github.com/mavlink/qgroundcontrol/blob/master/src/MissionManager/MavCmdInfoVTOL.json" target="_blank" rel="noreferrer">VTOL</a>. And here are the overrides for (Fixed Wings)(<a href="https://github.com/mavlink/qgroundcontrol/blob/master/src/MissionManager/MavCmdInfoFixedWing.json#L7" target="_blank" rel="noreferrer">https://github.com/mavlink/qgroundcontrol/blob/master/src/MissionManager/MavCmdInfoFixedWing.json#L7</a>):</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span>        {</span></span>
<span class="line"><span>            &quot;id&quot;:           16,</span></span>
<span class="line"><span>            &quot;comment&quot;:      &quot;MAV_CMD_NAV_WAYPOINT&quot;,</span></span>
<span class="line"><span>            &quot;paramRemove&quot;:  &quot;4&quot;</span></span>
<span class="line"><span>        },</span></span></code></pre></div><p>What this does is remove the editing UI for param4 which is Yaw and not used by fixed wings. Since this is a leaf node of the root, this applies to all fixed wing vehicle no matter the firmware type.</p><h3 id="root-firmware-type-specific-leaf-node" tabindex="-1">Root - Firmware Type Specific leaf node <a class="header-anchor" href="#root-firmware-type-specific-leaf-node" aria-label="Permalink to &quot;Root - Firmware Type Specific leaf node&quot;">​</a></h3><p>The next level of the hiearchy are overrides which are specific to a firmware type but apply to all vehicle types. Once again lets loook at the waypoint overrides:</p><p><a href="https://github.com/mavlink/qgroundcontrol/blob/master/src/FirmwarePlugin/APM/MavCmdInfoCommon.json#L6" target="_blank" rel="noreferrer">ArduPilot</a>:</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span>        {</span></span>
<span class="line"><span>            &quot;id&quot;:           16,</span></span>
<span class="line"><span>            &quot;comment&quot;:      &quot;MAV_CMD_NAV_WAYPOINT&quot;,</span></span>
<span class="line"><span>            &quot;paramRemove&quot;:  &quot;2&quot;</span></span>
<span class="line"><span>        },</span></span></code></pre></div><p><a href="https://github.com/mavlink/qgroundcontrol/blob/master/src/FirmwarePlugin/PX4/MavCmdInfoCommon.json#L7" target="_blank" rel="noreferrer">PX4</a>:</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span>        {</span></span>
<span class="line"><span>            &quot;id&quot;:           16,</span></span>
<span class="line"><span>            &quot;comment&quot;:      &quot;MAV_CMD_NAV_WAYPOINT&quot;,</span></span>
<span class="line"><span>            &quot;paramRemove&quot;:  &quot;2,3&quot;</span></span>
<span class="line"><span>        },</span></span></code></pre></div><p>You can see that for both firmwares param2 which is acceptance radius is removed from the editing ui. This is a QGC specific decision. It is generally safer and easier to use the firmwares generic acceptance radius handling than the specify a value. So we&#39;ve decided to hide it from users.</p><p>You can also see that for PX4 param3/PassThru is removed since it is not supported by PX.</p><h3 id="root-firmware-type-specific-vehicle-type-specific-leaf-node" tabindex="-1">Root - Firmware Type Specific - Vehicle Type Specific leaf node <a class="header-anchor" href="#root-firmware-type-specific-vehicle-type-specific-leaf-node" aria-label="Permalink to &quot;Root - Firmware Type Specific - Vehicle Type Specific leaf node&quot;">​</a></h3><p>The last level of the hiearchy is both firmware and vehicle type specific.</p><p><a href="https://github.com/mavlink/qgroundcontrol/blob/master/src/FirmwarePlugin/APM/MavCmdInfoMultiRotor.json#L7" target="_blank" rel="noreferrer">ArduPilot/MR</a>:</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span>        {</span></span>
<span class="line"><span>            &quot;id&quot;:           16,</span></span>
<span class="line"><span>            &quot;comment&quot;:      &quot;MAV_CMD_NAV_WAYPOINT&quot;,</span></span>
<span class="line"><span>            &quot;paramRemove&quot;:  &quot;2,3,4&quot;</span></span>
<span class="line"><span>        },</span></span></code></pre></div><p>Here you can see that for an ArduPilot Multi-Rotor vehicle param2/3/4 Acceptance/PassThru/Yaw are removed. Yaw for example is removed because it is not supported. Due to quirk of how this code works, you need to repeat the overrides from the lower level.</p><h2 id="mission-command-ui-info" tabindex="-1">Mission Command UI Info <a class="header-anchor" href="#mission-command-ui-info" aria-label="Permalink to &quot;Mission Command UI Info&quot;">​</a></h2><p>Two classes define the metadata associated with a command:</p><ul><li>MissionCommandUIInfo - Metadata for the entire command</li><li>MissionCmdParamInfo - Metadata for a param in a command</li></ul><p>The source is commented with full details of the json keys which are supported.</p><p><a href="https://github.com/mavlink/qgroundcontrol/blob/master/src/MissionManager/MissionCommandUIInfo.h#L82" target="_blank" rel="noreferrer">MissionCommandUIInfo</a>:</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span>/// UI Information associated with a mission command (MAV_CMD)</span></span>
<span class="line"><span>///</span></span>
<span class="line"><span>/// MissionCommandUIInfo is used to automatically generate editing ui for a MAV_CMD. This object also supports the concept of only having a set of partial</span></span>
<span class="line"><span>/// information for the command. This is used to create overrides of the base command information. For on override just specify the keys you want to modify</span></span>
<span class="line"><span>/// from the base command ui info. To override param ui info you must specify the entire MissionParamInfo object.</span></span>
<span class="line"><span>///</span></span>
<span class="line"><span>/// The json format for a MissionCommandUIInfo object is:</span></span>
<span class="line"><span>///</span></span>
<span class="line"><span>/// Key                     Type    Default     Description</span></span>
<span class="line"><span>/// id                      int     reauired    MAV_CMD id</span></span>
<span class="line"><span>/// comment                 string              Used to add a comment</span></span>
<span class="line"><span>/// rawName                 string  required    MAV_CMD enum name, should only be set of base tree information</span></span>
<span class="line"><span>/// friendlyName            string  rawName     Short description of command</span></span>
<span class="line"><span>/// description             string              Long description of command</span></span>
<span class="line"><span>/// specifiesCoordinate     bool    false       true: Command specifies a lat/lon/alt coordinate</span></span>
<span class="line"><span>/// specifiesAltitudeOnly   bool    false       true: Command specifies an altitude only (no coordinate)</span></span>
<span class="line"><span>/// standaloneCoordinate    bool    false       true: Vehicle does not fly through coordinate associated with command (exampl: ROI)</span></span>
<span class="line"><span>/// isLandCommand           bool    false       true: Command specifies a land command (LAND, VTOL_LAND, ...)</span></span>
<span class="line"><span>/// friendlyEdit            bool    false       true: Command supports friendly editing dialog, false: Command supports &#39;Show all values&quot; style editing only</span></span>
<span class="line"><span>/// category                string  Advanced    Category which this command belongs to</span></span>
<span class="line"><span>/// paramRemove             string              Used by an override to remove params, example: &quot;1,3&quot; will remove params 1 and 3 on the override</span></span>
<span class="line"><span>/// param[1-7]              object              MissionCommandParamInfo object</span></span>
<span class="line"><span>///</span></span></code></pre></div><p><a href="https://github.com/mavlink/qgroundcontrol/blob/master/src/MissionManager/MissionCommandUIInfo.h#L25" target="_blank" rel="noreferrer">MissionCmdParamInfo</a>:</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span>/// UI Information associated with a mission command (MAV_CMD) parameter</span></span>
<span class="line"><span>///</span></span>
<span class="line"><span>/// MissionCommandParamInfo is used to automatically generate editing ui for a parameter associated with a MAV_CMD.</span></span>
<span class="line"><span>///</span></span>
<span class="line"><span>/// The json format for a MissionCmdParamInfo object is:</span></span>
<span class="line"><span>///</span></span>
<span class="line"><span>/// Key             Type    Default     Description</span></span>
<span class="line"><span>/// label           string  required    Label for text field</span></span>
<span class="line"><span>/// units           string              Units for value, should use FactMetaData units strings in order to get automatic translation</span></span>
<span class="line"><span>/// default         double  0.0/NaN     Default value for param. If no default value specified and nanUnchanged == true, then defaultValue is NaN.</span></span>
<span class="line"><span>/// decimalPlaces   int     7           Number of decimal places to show for value</span></span>
<span class="line"><span>/// enumStrings     string              Strings to show in combo box for selection</span></span>
<span class="line"><span>/// enumValues      string              Values associated with each enum string</span></span>
<span class="line"><span>/// nanUnchanged    bool    false       True: value can be set to NaN to signal unchanged</span></span></code></pre></div>`,46),t=[i];function p(r,l,c,d,m,u){return e(),n("div",null,t)}const g=a(o,[["render",p]]);export{f as __pageData,g as default};
