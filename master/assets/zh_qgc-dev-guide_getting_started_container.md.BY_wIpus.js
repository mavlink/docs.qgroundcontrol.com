import{_ as i,c as a,o as e,ag as t}from"./chunks/framework.BudlMBKT.js";const c=JSON.parse('{"title":"使用容器构建","description":"","frontmatter":{},"headers":[],"relativePath":"zh/qgc-dev-guide/getting_started/container.md","filePath":"zh/qgc-dev-guide/getting_started/container.md"}'),n={name:"zh/qgc-dev-guide/getting_started/container.md"};function h(l,s,p,d,o,k){return e(),a("div",null,s[0]||(s[0]=[t(`<h1 id="使用容器构建" tabindex="-1">使用容器构建 <a class="header-anchor" href="#使用容器构建" aria-label="Permalink to &quot;使用容器构建&quot;">​</a></h1><p>社区创建了一个 Docker 镜像，这使得构建基于 Linux 的 QGC 应用程序变得容易得多。 这可以大大提高您的生产力，并帮助您进行测试。</p><h2 id="关于容器" tabindex="-1">关于容器 <a class="header-anchor" href="#关于容器" aria-label="Permalink to &quot;关于容器&quot;">​</a></h2><p>容器位于 <code>./depl/docker</code> 目录中。 It&#39;s based on <strong>Ubuntu 24.04</strong>. However, always check the first lines of the Dockerfile in the aforementioned directory to have zero surprises.</p><p>It checks and pre-installs all the dependencies at build time, including Qt, thanks to the use of scripts from the directory <code>./tools/setup</code>. The main advantage of using the container is the usage of the <code>CMake</code> build system and its many improvements over <code>qmake</code>.</p><h2 id="构建容器" tabindex="-1">构建容器 <a class="header-anchor" href="#构建容器" aria-label="Permalink to &quot;构建容器&quot;">​</a></h2><h3 id="脚本" tabindex="-1">脚本 <a class="header-anchor" href="#脚本" aria-label="Permalink to &quot;脚本&quot;">​</a></h3><p>要使用脚本构建容器，请在 qgc 根目录中运行此命令</p><div class="language-sh vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">./depl/docker/run-docker-ubuntu.sh</span></span></code></pre></div><h3 id="手册" tabindex="-1">手册 <a class="header-anchor" href="#手册" aria-label="Permalink to &quot;手册&quot;">​</a></h3><p>如果你想要手动使用容器构建，那么你必须先构建镜像。 您可以使用 docker 完成这个操作，从QGC 源代码目录的根目录运行下面的脚本。</p><div class="language-sh vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">docker</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> build</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --file</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> ./deploy/docker/Dockerfile-build-ubuntu</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -t</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> qgc-ubuntu-docker</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> .</span></span></code></pre></div><div class="info custom-block"><p class="custom-block-title">INFO</p><p><code>-t</code> 选项至关重要。 请记住，这是为镜像添加标签以便日后引用，因为同一容器可能会有多个构建版本。</p></div><div class="info custom-block"><p class="custom-block-title">INFO</p><p>If building on a Mac computer with an M1 chip you must also specify the build option <code>--platform linux/x86_64</code> as shown:</p><div class="language-sh vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">docker</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> build</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --platform</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> linux/x86_64</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --file</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> ./deploy/docker/Dockerfile-build-ubuntu</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -t</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> qgc-ubuntu-docker</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> .</span></span></code></pre></div><p>否则，你将会遇到一个构建错误，比如：</p><div class="language-sh vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">qemu-x86_64:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> Could</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> not</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> open</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;/lib64/ld-linux-x86-64.so.2&#39;:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> No</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> such</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> file</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> or</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> directory</span></span></code></pre></div></div><h2 id="使用容器构建qgc" tabindex="-1">使用容器构建QGC <a class="header-anchor" href="#使用容器构建qgc" aria-label="Permalink to &quot;使用容器构建QGC&quot;">​</a></h2><p>要使用该容器构建 QGC，首先需要定义一个目录来保存构建产物。 我们建议你在源代码树中创建一个“build”目录，然后从根目录使用上述提供的标签按如下方式运行Docker镜像：</p><div class="language-sh vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">mkdir</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> build</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">docker</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> run</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --rm</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -v</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> \${PWD}</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">:/project/source</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -v</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> \${PWD}</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">/build:/project/build</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> qgc-ubuntu-docker</span></span></code></pre></div><div class="info custom-block"><p class="custom-block-title">INFO</p><p>For up to date docker command and options reference relevant run-script in <code>deploy/docker</code>, for example <a href="https://github.com/mavlink/qgroundcontrol/blob/master/deploy/docker/run-docker-ubuntu.sh#L16" target="_blank" rel="noreferrer">run-docker-ubuntu.sh</a>.</p></div><div class="info custom-block"><p class="custom-block-title">INFO</p><p>If using the script to build the Linux image on a Windows host, you would need to reference the PWD differently. On Windows the docker command is:</p><div class="language-sh vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">docker</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> run</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --rm</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -v</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> %cd%:/project/source</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -v</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> %cd%/build:/project/build</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> qgc-ubuntu-docker</span></span></code></pre></div></div><p>根据您的系统资源或分配给您的 Docker 守护进程的资源，构建步骤可能需要一些时间。</p><h2 id="故障处理" tabindex="-1">故障处理 <a class="header-anchor" href="#故障处理" aria-label="Permalink to &quot;故障处理&quot;">​</a></h2><h3 id="windows-bash-r-no-such-file-or-directory" tabindex="-1">Windows: &#39;bash\\r&#39;: No such file or directory <a class="header-anchor" href="#windows-bash-r-no-such-file-or-directory" aria-label="Permalink to &quot;Windows: &#39;bash\\r&#39;: No such file or directory&quot;">​</a></h3><p>此错误表明正在以Windows换行符格式运行Linux脚本。如果将 <code>git</code> 配置为使用Windows换行符，就可能出现这种情况。</p><div class="language-sh vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> &gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> [4/7] </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">RUN</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /tmp/qt/install-qt-linux.sh:</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">#9 0.445 /usr/bin/env: &#39;bash\\r&#39;: No such file or directory</span></span></code></pre></div><p>一个修复是强制使用 Linux 行尾使用命令：</p><div class="language-sh vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">git</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> config</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --global</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> core.autocrlf</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> false</span></span></code></pre></div><p>然后更新/重新创建您的本地资源库。 For, example, use:</p><div class="language-sh vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">git</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> rm</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --cached</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -r</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> .</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">git</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> reset</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --hard</span></span></code></pre></div>`,28)]))}const u=i(n,[["render",h]]);export{c as __pageData,u as default};
